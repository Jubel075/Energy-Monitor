\section{Overview of the Application}

% Preset code colors for python 
\lstset{
    language=Python,             % Language of the code
    basicstyle=\ttfamily\small,  % Basic font style
    keywordstyle=\color{blue},   % Style for keywords
    commentstyle=\color{green},  % Style for comments
    stringstyle=\color{red},     % Style for strings
    frame=single,                % Draw a frame around the code
    breaklines=true,             % Allow line breaks within code
    captionpos=b,                % Set the caption position to bottom
    numbers=left,                % Add line numbers on the left
    numberstyle=\tiny\color{gray}, % Style for line numbers
}

The application consists of the following components:
\begin{itemize}
    \item \textbf{Backend (app.py):} Built with Flask, it fetches data from a PostgreSQL database, processes it, and serves it to the front-end.
    \item \textbf{Frontend (index.html):} A responsive HTML page styled with CSS, allowing users to select filters and view energy data in a Plotly graph.
    \item \textbf{CSS (style.css):} Defines styles for the HTML elements to make the dashboard user-friendly and visually appealing.
\end{itemize}

\section{Backend Code (app.py)}

The main backend code in \texttt{app.py} initializes the Flask app, loads environment variables, connects to the PostgreSQL database, and defines routes for data retrieval and front-end rendering.

\subsection{Code Listing}
Below is the \texttt{app.py} code, with comments explaining each section.

\begin{lstlisting}[language=Python, caption=app.py, frame=single]
# Import necessary libraries
from flask import Flask, render_template, jsonify, request
import pandas as pd
import plotly.graph_objects as go
from dotenv import load_dotenv
import os
import psycopg2
from psycopg2 import OperationalError

# Initialize Flask application
app = Flask(__name__)

# Load environment variables from the .env file for secure configuration
load_dotenv()

# Get the database connection URL from environment variables
DATABASE_URL = os.getenv("DATABASE_URL")

# Define function to fetch and process data from the PostgreSQL database
def get_data(tab, group_by=None, selected_month=None, selected_day=None):
    try:
        # Connect to the database
        conn = psycopg2.connect(DATABASE_URL)
        query = "SELECT date, irms, energy_usage, kwh FROM energydata"
        df = pd.read_sql_query(query, conn)  # Read data into a DataFrame
        conn.close()  # Close the connection after fetching data
    except OperationalError as e:
        print("Error connecting to the database:", e)
        return pd.DataFrame()  # Return empty DataFrame if connection fails

    # Process date and extract date components for filtering
    df['date'] = pd.to_datetime(df['date'], format='%Y-%m-%d %H:%M:%S', errors='coerce')
    df['year'] = df['date'].dt.year
    df['month'] = df['date'].dt.month_name()
    df['day'] = df['date'].dt.day
    df['hour'] = df['date'].dt.hour
    df = df.sort_values(by='date')  # Sort data by date for plotting

    # Apply filters based on selected month and day
    if selected_month:
        df = df[df['month'] == selected_month]
        df = df.sort_values(by=['day', 'date'])
    if selected_day:
        df = df[df['day'] == int(selected_day)]
        df = df.sort_values(by=['hour', 'date'])

    return df  # Return filtered data

# Define the main route for the application
@app.route('/')
def index():
    # Retrieve user-selected month, day, and metric type from the URL parameters
    selected_month = request.args.get('month')
    selected_day = request.args.get('day')
    selected_tab = request.args.get('tab', 'irms')  # Default to 'irms' tab if none selected

    # Fetch and filter data based on user selections
    df = get_data(tab=selected_tab, selected_month=selected_month, selected_day=selected_day)

    # Create Plotly figure based on the selected tab (irms, energy_usage, or kWh)
    fig = go.Figure()
    if selected_tab == 'irms':
        fig.add_trace(go.Scatter(x=df['date'], y=df['irms'], mode='lines', name='Irms'))
        fig.update_layout(title="Current (Irms)", xaxis_title="Date", yaxis_title="Current (A)")
    elif selected_tab == 'energy_usage':
        fig.add_trace(go.Scatter(x=df['date'], y=df['energy_usage'], mode='lines', name='Energy Usage'))
        fig.update_layout(title="Energy Usage (Ws)", xaxis_title="Date", yaxis_title="Energy (Ws)")
    else:
        fig.add_trace(go.Scatter(x=df['date'], y=df['kwh'], mode='lines', name='kWh'))
        fig.update_layout(title="Energy Consumption (kWh)", xaxis_title="Date", yaxis_title="kWh")

    # Convert Plotly figure to HTML to embed in the front-end
    graph_html = fig.to_html(full_html=False)

    # Prepare month and day options for dropdowns in the front-end
    month_options = [{'value': month, 'label': month} for month in df['month'].unique()]
    day_options = df['day'].unique().tolist()

    # Render the front-end template with graph and dropdown options
    return render_template('index.html', 
                           graph_html=graph_html,
                           selected_month=selected_month, 
                           selected_day=selected_day,
                           selected_tab=selected_tab,
                           month_options=month_options,
                           day_options=day_options)

# Route to fetch day options dynamically when a month is selected
@app.route('/days', methods=['GET'])
def get_days():
    selected_month = request.args.get('month')
    df = get_data(tab='irms', selected_month=selected_month)
    days = df['day'].unique().tolist()
    return jsonify(days)

# Run the Flask app
if __name__ == '__main__':
    app.run(debug=True)
\end{lstlisting}

\section{Frontend Code (index.html)}

The HTML template for the dashboard displays dropdown menus for filtering by month and day, tab navigation, and the Plotly graph.

\subsection{Code Listing}
Below is the \texttt{index.html} code with added comments.

\begin{lstlisting}[language=HTML, caption=index.html, frame=single]
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta tags and imports for responsive design -->
</head>
<body>
    <div class="container">
        <header>
            <h1>Energy Data Dashboard</h1>
        </header>

        <!-- Dropdown Filters for selecting Month and Day -->
        <div class="dropdowns">
            <div class="dropdown-container">
                <label for="month-dropdown">Select Month</label>
                <select id="month-dropdown">
                    <option value="">-- Select Month --</option>
                    {% for month in month_options %}
                        <!-- Pre-select the chosen month in the dropdown -->
                        <option value="{{ month['value'] }}" {% if selected_month == month['value'] %}selected{% endif %}>{{ month['label'] }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="dropdown-container">
                <label for="day-dropdown">Select Day</label>
                <select id="day-dropdown" {% if not selected_month %}disabled{% endif %}>
                    <option value="">-- Select Day --</option>
                    {% if selected_month %}
                        {% for day in day_options %}
                            <option value="{{ day }}" {% if selected_day == day %}selected{% endif %}>Day {{ day }}</option>
                        {% endfor %}
                    {% endif %}
                </select>
            </div>
        </div>

        <!-- Tabs for selecting the data type (Irms, Energy Usage, or kWh) -->
        <div class="tabs-and-reset">
            <!-- Tab elements go here -->
        </div>

        <!-- Container for the Plotly graph -->
        <div id="plotly-graph" class="graph-container">
            {{ graph_html | safe }}
        </div>

        <footer>
            <p>Â© 2024 Energy Data Dashboard. All rights reserved.</p>
        </footer>
    </div>
</body>
</html>
\end{lstlisting}

\section{CSS Code (style.css)}

The CSS file customizes the appearance of the dashboard, including layout, colors, and responsive adjustments for different screen sizes.

\subsection{Code Listing}
Below is the \texttt{style.css} code with added comments.

\begin{lstlisting}[language=CSS, caption=style.css, frame=single]
/* General Reset and Global Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #e2f095 0%, #3498db 100%);
    color: #333;
    line-height: 1.6;
    padding: 20px;
}

/* Container Styling */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px;
    background-color: #ffffff;
    border-radius: 15px;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
}

/* Header Styling */
header {
    text-align: center;
    margin-bottom: 40px;
}

h1 {
    color: #34495e;
    font-size: 3.5em;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 2px;
}

/* Dropdown Styling */
.dropdowns {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    margin-bottom: 30px;
    flex-wrap: wrap; /* Allow wrapping on small screens */
}

.dropdown-container {
    flex: 1;
    min-width: 200px;  /* Ensures it doesn't get too small on mobile */
}

select {
    padding: 12px 18px;
    font-size: 1.1em;
    border-radius: 8px;
    border: 1px solid #ddd;
    width: 100%;
    transition: all 0.3s ease;
    background-color: #fafafa;
    color: #2c3e50;
}

select:focus {
    border-color: #3498db;
    background-color: #fff;
    outline: none;
}

select:hover {
    border-color: #3498db;
    cursor: pointer;
}

/* Tab Styling */
.tabs {
    margin-bottom: 30px;
}

.tab-titles {
    list-style: none;
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 0;
}

.tab-titles li {
    font-size: 1.2em;
    cursor: pointer;
}

.tab-titles a {
    text-decoration: none;
    color: #2c3e50;
    padding: 10px 20px;
    border-radius: 8px;
    background-color: #f5f5f5;
    transition: all 0.3s ease;
}

.tab-titles a:hover,
.tab-titles li.active a {
    background-color: #3498db;
    color: white;
}

/* Graph Container Styling */
.graph-container {
    width: 100%;
    height: 600px;
    background-color: #ffffff;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

/* Footer Styling */
footer {
    text-align: center;
    margin-top: 50px;
    font-size: 1em;
    color: #7f8c8d;
}

/* Tabs and Reset Container */
.tabs-and-reset {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    margin-bottom: 20px;
}

#reset-button {
    background-color: #e74c3c;
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 1.2em;
    cursor: pointer;
    border-radius: 8px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

#reset-button i {
    font-size: 1.4em;
}

#reset-button:hover {
    background-color: #c0392b;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .dropdowns {
        flex-direction: column;
        gap: 10px;
    }

    .tab-titles {
        flex-direction: column;
        gap: 10px;
    }

    .tabs-and-reset {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }

    #reset-button {
        width: 100%;
        text-align: center;
    }
} 
\end{lstlisting}